
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QR Labels & Sheets — Demo</title>
<link rel="icon" href="data:,">
<style>
  :root{--bg:#0b1020;--panel:#0f1730;--card:#131c39;--line:#223061;--text:#e8ecff;--muted:#a9b6e9;--accent:#8ab4ff}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(180deg,#0b1020,#0d1834);color:var(--text);font:14px/1.5 system-ui,Segoe UI,Roboto,Arial}
  header{position:sticky;top:0;z-index:5;background:#0b1020cc;backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .wrap{max-width:1200px;margin:0 auto;padding:14px 16px;display:grid;grid-template-columns:auto 1fr auto auto;gap:10px;align-items:center}
  .title{font-weight:700}
  .tabs{display:flex;gap:6px}
  .tab{padding:8px 10px;border:1px solid var(--line);border-radius:9px;background:#101b3b;cursor:pointer}
  .tab[data-active="true"]{background:var(--accent);color:#0a0f22;border-color:transparent}
  input[type="text"]{flex:1;min-width:220px;background:var(--panel);border:1px solid var(--line);color:var(--text);padding:10px 12px;border-radius:10px}
  .btn{background:#2a3f7a;border:1px solid var(--line);color:var(--text);padding:10px 12px;border-radius:10px;cursor:pointer;text-decoration:none}
  main{max-width:1200px;margin:0 auto;padding:18px 16px}
  .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:12px}
  .chip{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#101b3b;cursor:pointer}
  .chip[data-active="true"]{background:var(--accent);color:#0a0f22;border-color:transparent}
  .count{margin-left:auto;opacity:.85}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;box-shadow:0 8px 30px #0006}
  .img{aspect-ratio:1/1;display:flex;align-items:center;justify-content:center;background:#0b1430;border-bottom:1px solid var(--line)}
  .img img{max-width:88%;max-height:88%;image-rendering:pixelated}
  .pad{padding:12px}.label{font-weight:700}.sub{color:var(--muted);font-size:13px;margin-top:2px;word-break:break-all}
  .row{display:flex;gap:8px;margin-top:10px}.row .btn{flex:1;text-align:center}
  .hint{opacity:.85;font-size:13px}
  footer{opacity:.75;text-align:center;padding:28px}

  /* TABLE VIEW */
  .tablewrap{border:1px solid var(--line);border-radius:12px;overflow:auto;background:#0f1730}
  table{width:100%;border-collapse:collapse;min-width:900px}
  thead th{position:sticky;top:0;background:#0c1330;border-bottom:1px solid var(--line);padding:10px;text-align:left}
  tbody td{border-top:1px solid #203063;padding:8px 10px;vertical-align:top}
  .mini{font-size:12px;opacity:.9}
  .btn-sm{padding:6px 8px;border-radius:8px}
  .nowrap{white-space:nowrap}
  @media (max-width:760px){ .wrap{grid-template-columns:1fr} .count{margin:0} }
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
</head>
<body>
<header>
  <div class="wrap">
    <div class="title">QR Labels & Sheets — Demo</div>
    <div class="tabs">
      <div class="tab" id="tab-cards" data-active="true">Cards</div>
      <div class="tab" id="tab-table">Table</div>
    </div>
    <input id="q" type="text" placeholder="Pretraga (Label, URL, SSID)…" />
    <button id="reload" class="btn">Reload</button>
  </div>
</header>

<main>
  <div class="toolbar">
    <div class="chip" data-filter="ALL" data-active="true">All</div>
    <div class="chip" data-filter="URL">URL</div>
    <div class="chip" data-filter="WIFI">WIFI</div>
    <div class="count" id="count"></div>
  </div>

  <!-- CARDS -->
  <section id="view-cards">
    <div id="grid" class="grid"></div>
    <div class="hint">Source: CSV. “Download PNG/SVG” su linkovi ka slikama QR-a. Za originalni target dodali smo “Open URL” u Table modu.</div>
  </section>

  <!-- TABLE -->
  <section id="view-table" style="display:none">
    <div class="tablewrap">
      <table id="tbl">
        <thead>
          <tr>
            <th>Label</th>
            <th>Type</th>
            <th>Target / SSID</th>
            <th class="nowrap">Actions</th>
            <th>QR_String</th>
            <th class="nowrap">PNG</th>
            <th class="nowrap">SVG</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="hint">U “Actions” možeš: <b>Open URL</b> (za URL tip), <b>Copy Wi-Fi</b>, <b>Copy QR</b>. PNG/SVG otvaraju direktne fajlove.</div>
  </section>
</main>

<footer>Made for Microns — static, no backend, easy handover.</footer>

<script>
/*** CONFIG ***/
const CONFIG = { CSV_URL: "qr_items.csv" }; // koristiš lokalni CSV u root-u
const override = new URLSearchParams(location.search).get('csv');
if (override) CONFIG.CSV_URL = override;

/*** STATE ***/
let allRows=[], viewRows=[];
const grid = document.getElementById('grid');
const count = document.getElementById('count');
const search = document.getElementById('q');
const tblBody = document.querySelector('#tbl tbody');

/*** LOAD CSV ***/
async function loadCsv(){
  const res = await fetch(CONFIG.CSV_URL);
  const text = await res.text();
  const parsed = Papa.parse(text, {header:true, skipEmptyLines:true});
  allRows = parsed.data.map(r=>({
    Label: (r.Label||r.label||r.Name||"").trim(),
    Type: (r.Type||r.type||"").trim(),
    URL: (r.URL||r.url||"").trim(),
    WiFi_SSID: (r.WiFi_SSID||r.WIFI_SSID||r.ssid||"").trim(),
    WiFi_Security: (r.WiFi_Security||r.security||"").trim(),
    WiFi_Password: (r.WiFi_Password||r.password||"").trim(),
    QR_String: (r.QR_String||r.qr_string||r.QR||"").trim(),
    PNG_URL: (r.PNG_URL||r.png_url||"").trim(),
    SVG_URL: (r.SVG_URL||r.svg_url||"").trim()
  })).filter(r => r.Label || r.PNG_URL || r.QR_String);
  viewRows = allRows.slice();
  renderCards(); renderTable(); makeSearch();
}

/*** SEARCH + FILTER ***/
function currentFilter(){ return document.querySelector('.chip[data-active="true"]').dataset.filter; }
function filtered(rows){
  const f = currentFilter(); return f==="ALL" ? rows : rows.filter(r=>r.Type===f);
}
function makeSearch(){
  const fuse = new Fuse(allRows, { keys:["Label","URL","WiFi_SSID"], threshold:0.35, ignoreLocation:true });
  search.oninput = e => {
    const q = e.target.value.trim();
    const base = q ? fuse.search(q).map(x=>x.item) : allRows.slice();
    viewRows = filtered(base);
    renderCards(); renderTable();
  };
}
document.querySelectorAll('.chip').forEach(c=>c.onclick=()=>{
  document.querySelectorAll('.chip').forEach(x=>x.dataset.active="false");
  c.dataset.active="true";
  const q = search.value.trim();
  const fuse = new Fuse(allRows, { keys:["Label","URL","WiFi_SSID"], threshold:0.35, ignoreLocation:true });
  const base = q ? fuse.search(q).map(x=>x.item) : allRows.slice();
  viewRows = filtered(base); renderCards(); renderTable();
});

/*** RENDER CARDS ***/
function renderCards(){
  count.textContent = `${viewRows.length} item(s)`;
  grid.innerHTML = "";
  for(const r of viewRows){
    const card = document.createElement('div'); card.className='card';
    const imgWrap = document.createElement('div'); imgWrap.className='img';
    const img = new Image(); img.loading='lazy'; img.src = r.PNG_URL || '';
    img.alt = r.Label || 'QR'; imgWrap.appendChild(img);

    const body = document.createElement('div'); body.className='pad';
    const label = document.createElement('div'); label.className='label'; label.textContent = r.Label || "(no label)";
    const sub = document.createElement('div'); sub.className='sub';
    sub.textContent = r.Type==="WIFI" ? (r.WiFi_SSID||"") : (r.URL||"");

    const row = document.createElement('div'); row.className='row';
    const a1 = document.createElement('a'); a1.className='btn'; a1.textContent='Download PNG'; a1.href=r.PNG_URL; a1.target='_blank'; a1.rel='noopener';
    row.appendChild(a1);
    if(r.SVG_URL){ const a2=document.createElement('a'); a2.className='btn'; a2.textContent='Download SVG'; a2.href=r.SVG_URL; a2.target='_blank'; a2.rel='noopener'; row.appendChild(a2); }

    body.append(label, sub, row); card.append(imgWrap, body); grid.append(card);
  }
}

/*** RENDER TABLE ***/
function renderTable(){
  tblBody.innerHTML = "";
  for(const r of viewRows){
    const tr = document.createElement('tr');

    const tdLabel = document.createElement('td'); tdLabel.textContent = r.Label || "";
    const tdType  = document.createElement('td');  tdType.textContent  = r.Type || "";
    const tdTarget= document.createElement('td'); 
    tdTarget.innerHTML = (r.Type==="WIFI")
      ? `<div class="mini"><b>SSID:</b> ${escapeHtml(r.WiFi_SSID)} | <b>Sec:</b> ${escapeHtml(r.WiFi_Security)} | <b>Pass:</b> ${escapeHtml(r.WiFi_Password)}</div>`
      : `<a href="${escapeAttr(r.URL)}" target="_blank" rel="noopener">${escapeHtml(r.URL)}</a>`;

    const tdAct = document.createElement('td'); tdAct.className='nowrap';
    if(r.Type==="URL" && r.URL){
      const openBtn = btn('Open URL', ()=>window.open(r.URL,'_blank'));
      tdAct.appendChild(openBtn);
    }
    if(r.Type==="WIFI"){
      const w = `SSID:${r.WiFi_SSID} | SEC:${r.WiFi_Security} | PASS:${r.WiFi_Password}`;
      const copyWifi = btn('Copy Wi-Fi', ()=>copy(w));
      tdAct.appendChild(copyWifi);
    }
    const copyQR = btn('Copy QR', ()=>copy(r.QR_String || (r.Type==="WIFI" ? wifiToQR(r) : r.URL||"")));
    tdAct.appendChild(copyQR);

    const tdQR  = document.createElement('td'); tdQR.className='mini'; tdQR.textContent = r.QR_String || (r.Type==="WIFI" ? wifiToQR(r) : r.URL||"");

    const tdPNG = document.createElement('td'); tdPNG.className='nowrap';
    if(r.PNG_URL){ tdPNG.appendChild(linkBtn('Open PNG', r.PNG_URL)); }

    const tdSVG = document.createElement('td'); tdSVG.className='nowrap';
    if(r.SVG_URL){ tdSVG.appendChild(linkBtn('Open SVG', r.SVG_URL)); }

    tr.append(tdLabel, tdType, tdTarget, tdAct, tdQR, tdPNG, tdSVG);
    tblBody.appendChild(tr);
  }
}

/*** HELPERS ***/
function btn(txt, onClick){ const b=document.createElement('button'); b.className='btn btn-sm'; b.textContent=txt; b.onclick=onClick; return b; }
function linkBtn(txt, href){ const a=document.createElement('a'); a.className='btn btn-sm'; a.textContent=txt; a.href=href; a.target='_blank'; a.rel='noopener'; return a; }
function copy(text){ if(!text) return; navigator.clipboard.writeText(text).then(()=>alert('Copied!')).catch(()=>alert(text)); }
function wifiToQR(r){
  const H = r.Hidden==="true" || r.Hidden===true ? "true" : "false";
  return `WIFI:T:${(r.WiFi_Security||'').toUpperCase()};S:${r.WiFi_SSID||''};P:${r.WiFi_Password||''};H:${H};;`;
}
function escapeHtml(s){ return (s||"").replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
function escapeAttr(s){ return (s||"").replace(/"/g,"%22"); }

/*** TABS ***/
const tabCards = document.getElementById('tab-cards');
const tabTable = document.getElementById('tab-table');
tabCards.onclick = ()=>{ tabCards.dataset.active="true"; tabTable.dataset.active="false"; show('view-cards'); hide('view-table'); };
tabTable.onclick = ()=>{ tabCards.dataset.active="false"; tabTable.dataset.active="true"; hide('view-cards'); show('view-table'); };

function show(id){ document.getElementById(id).style.display=''; }
function hide(id){ document.getElementById(id).style.display='none'; }

/*** BIND ***/
document.getElementById('reload').onclick = loadCsv;

/*** START ***/
loadCsv();
</script>
</body>
</html>
